{% extends "base.html" %}
{% block title %}
    Records Procurement - View Request
{% endblock title %}
{% block custom_css_links %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap-editable.css') }}"/>
{% endblock %}
{% block content %}

    <div class="page-header">
        <h1>{{ request.id }}</h1>
        {% if current_user.role == "Administrator" %}
            <a href="{{ url_for('request.edit_request', request_id=request.id) }}">Edit</a>
        {% endif %}
    </div>

    <div class="col-sm-6">
        <div class="table-responsive">
            <table id="requests" class="table table-bordered table-striped">
                <colgroup>
                    <col class="col-xs-4">
                    <col class="col-xs-8">
                </colgroup>
                <tbody>
                <tr>
                    <th scope="row" colspan="2">Request Information</th>
                </tr>
                <tr>
                    <th scope="row">Request ID:</th>
                    <td>{{ request.id }}</td>
                </tr>
                <tr>
                    <th scope="row">Requester:</th>
                    <td><a href="mailto:{{ user.email }}">{{ user.name }}</a></td>
                </tr>
                <tr>
                    <th scope="row">Division:</th>
                    <td>{{ user.division }}</td>
                </tr>
                <tr>
                    <th scope="row">Item:</th>
                    <td><a href="#" id="item">{{ request.item }}</a></td>
                </tr>
                <tr>
                    <th scope="row">Quantity:</th>
                    <td><a href="#" id="quantity">{{ request.quantity }}</a></td>
                </tr>
                <tr>
                    <th scope="row">Unit Price:</th>
                    <td><a href="#" id="unit_price">${{ request.unit_price }}</a></td>
                </tr>
                <tr>
                    <th scope="row">Total Price:</th>
                    {% if request.total_cost %}
                        <td><a href="#" id="total_cost">${{ request.total_cost }}</a></td>
                    {% else %}
                        <td>$0.00</td>
                    {% endif %}
                </tr>
                <tr>
                    <th scope="row">Funding Source:</th>
                    <td><a href="#" id="funding_source">{{ request.funding_source }}</a></td>
                </tr>
                <!-- TODO: Funding Source Additional Info goes here. -->
                <tr>
                    <th scope="row">Justification:</th>
                    <td><a href="#" id="justification">{{ request.justification }}</a></td>
                </tr>
                <tr>
                    <th scope="row">Status:</th>
                    <td><a href="#" id="status">{{ request.status }}</a></td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div class="col-sm-push-5">
        <div class="table-responsive">
            <table class="table table-bordered table-striped">
                <colgroup>
                    <col class="col-xs-1">
                    <col class="col-xs-5">
                </colgroup>
                <tbody>
                <tr>
                    <th scope="row" colspan="2">Vendor Information</th>
                </tr>
                <tr>
                    <th scope="row">Name:</th>
                    <td><a href="#" id="vendor_name">{{ vendor.name }}</a></td>
                </tr>
                <tr>
                    <th scope="row">Address:</th>
                    <td><a href="#" id="vendor_address">{{ vendor.address }}</a></td>
                </tr>
                <tr>
                    <th scope="row">Phone:</th>
                    <td><a href="#" id="vendor_phone">{{ vendor.phone }}</a></td>
                </tr>
                <tr>
                    <th scope="row">Fax:</th>
                    <td><a href="#" id="vendor_fax">{{ vendor.fax }}</a></td>
                </tr>
                <tr>
                    <th scope="row">Email:</th>
                    <td><a href="mailto:{{ vendor.email }}" id="vendor_email">{{ vendor.email }}</a></td>
                </tr>
                <tr>
                    <th scope="row">Tax ID:</th>
                    <td><a href="#" id="vendor_taxid">{{ vendor.tax_id }}</a></td>
                </tr>
                <tr>
                    <th scope="row">M/WBE:</th>
                    {% if vendor.mwbe %}
                        <td><a href="#" id="vendor_mwbe">Yes</a></td>
                    {% else %}
                        <td><a href="#" id="vendor_mwbe">No</a></td>
                    {% endif %}
                </tr>
                </tbody>
            </table>
        </div>
        <div class="spacer"></div>
    </div>
    <div class="form-group row">
        <label for="notes" class="col-sm-7 form-control-label">NOTES</label>
        <div class="page-header"></div>

        {% if current_user.role != "Regular User" or current_user.id == request.creator_id %}
            <div class="form-group col">
                <form action="{{ url_for('request.add_comment') }}" method="post" enctype="multipart/form-data">
                    {{ comment_form.content(id="note", rows="3", cols="100", maxlength="500") }}
                    {{ comment_form.request_id(value=request.id) }}
                    {{ comment_form.file }}
                    {{ comment_form.submit }}
                </form>
            </div><br>
        {% endif %}

        {% for comment in comments %}
            <div class="form-group col">
                <form action="{{ url_for('request.delete_comment') }}"
                      method="post" value="{{ comment.id }}">
                    <label>{{ comment.timestamp.strftime("%m/%d/%Y %I:%M:%S %p") }}
                        | {{ comment.user.first_name }} {{ comment.user.last_name }}
                        {% if comment.user_id == current_user.id %}
                            (You)
                        {% elif comment.user_id == request.creator_id %}
                            (Creator)
                        {% endif %}
                    </label>
                    {% if current_user.role == "Administrator" or current_user.id == comment.user_id %}
                        {{ deleteform.request_id(value=request.id) }}
                        {{ deleteform.comment_id(value=comment.id) }}
                        {{ deleteform.submit }}
                    {% endif %}
                </form>
                <div>{{ comment.content }}</div>
                {% if comment.filepath %}
                    <div>
                        <a href="{{ url_for('request.download', comment_id=comment.id) }}">{{ comment.filepath[13:] }}</a>
                    </div>
                {% endif %}
            </div><br>
        {% endfor %}
    </div>
{% endblock %}

{% block scripts %}
    <script src="http://code.jquery.com/jquery-2.0.3.min.js"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/plugins/bootstrap-editable.js') }}"></script>
    {% block request_xeditable %}
        {% include "request/request_x-editable.html" %}
    {% endblock %}
{% endblock %}


